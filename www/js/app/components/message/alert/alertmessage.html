
<ion-view title="{{'messages' | translate}}">
	<ion-nav-buttons side="left">
		<button menu-toggle="left" class="button button-icon icon ion-navicon"></button>
	</ion-nav-buttons>

	<ion-nav-buttons side="right">
		<button ng-click="showPopup()" class="button button-icon icon ion-paperclip"></button>
	</ion-nav-buttons>

	<ion-content class="has-header has-footer" has-bouncing="true">
		<h2 ng-if="messages.length == 0">No hay mensajes</h2>
		<div ng-repeat="message in messages | orderBy:'createDate'" class="message-wrapper">
			<div ng-if="currentUser.$id !== message.user.$id">
				<img class="profile-pic left" 
					ng-src="{{message.user.avatar}}" />

				<div class="chat-bubble left">

					<img ng-src="{{message.picture.thumbnail}}" ng-if="!!message.picture.thumbnail"  ng-click="showPicture(message.picture.image)" />
					<div class="message" ng-bind-html="message.body|nl2br" autolinker>
					</div>

					<div class="message-detail">
						<span class="bold">{{message.user.username}}</span>,
						<span am-time-ago="message.createDate"></span>
					</div>

				</div>
			</div>

			<div ng-if="currentUser.$id === message.user.$id">
				<img class="profile-pic right" 
					ng-src="{{message.user.avatar}}"  />

				<div class="chat-bubble right">
					<img ng-src="{{message.picture.thumbnail}}" ng-if="message.picture.thumbnail"   ng-click="showPicture(message.picture.image)" />
					<div class="message" ng-bind-html="message.body|nl2br" autolinker>
					</div>

					<div class="message-detail">
						<span class="bold">{{message.user.username}}</span>,
						<span am-time-ago="message.createDate"></span>
					</div>
				</div>
			</div>

			<div class="cf"></div>
		</div>
	</ion-content>

	<form name="sendMessageForm" ng-submit="sendMessage()" novalidate ng-if="currentUser">
		<ion-footer-bar class="bar-stable item-input-inset message-footer" keyboard-attach>
			<label class="item-input-wrapper">
				<textarea ng-model="msg.body" value="" placeholder="Send a message..." required minlength="1" maxlength="1500" msd-elastic></textarea>
		   </label>
			<div class="footer-btn-wrap">
				<button class="button button-icon icon ion-android-send footer-btn" type="submit"
					ng-disabled="!msg.body|| msg.body === ''">
				</button>
			</div>
		</ion-footer-bar>
	</form>
	<div ng-if="!currentUser">
		<ion-footer-bar class="bar-stable item-input-inset message-footer">
			<span>Log in to post messages</span>
		</ion-footer-bar>
	</div>
</ion-view>

